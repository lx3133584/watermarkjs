!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.watermark=e():t.watermark=e()}(window,function(){return r={},i.m=n=[function(t,e,n){t.exports=n(1).default},function(t,e,n){"use strict";n.r(e),n.d(e,"default",function(){return A});var r={};n.r(r),n.d(r,"atPos",function(){return s}),n.d(r,"lowerRight",function(){return g}),n.d(r,"upperRight",function(){return p}),n.d(r,"lowerLeft",function(){return v}),n.d(r,"upperLeft",function(){return y}),n.d(r,"center",function(){return w});var i={};function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function f(r,i){return new Promise(function(n,t){wx.getImageInfo({src:r,success:function(t){var e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},t,{path:r});"function"==typeof i&&i(e),n(e)},fail:t})})}function l(t,n,e,r,i,u){var o=2<arguments.length&&void 0!==e?e:0,a=3<arguments.length&&void 0!==r?r:0,c=4<arguments.length?i:void 0,f=5<arguments.length?u:void 0,l=n.getContext("2d"),h=n.createImage();return h.src=t,new Promise(function(t,e){h.onload=function(){c&&f?l.drawImage(h,o,a,c,f):l.drawImage(h,o,a),t(n)},h.onerror=e})}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}n.r(i),n.d(i,"atPos",function(){return b}),n.d(i,"lowerRight",function(){return m}),n.d(i,"lowerLeft",function(){return x}),n.d(i,"upperRight",function(){return O}),n.d(i,"upperLeft",function(){return j}),n.d(i,"center",function(){return P});var c=function(){function r(){var t,e,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),n=null,(e="canvas")in(t=this)?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}var t,e,n;return t=r,(e=[{key:"init",value:function(t){var i=this;return new Promise(function(n,r){wx.createSelectorQuery().select("#"+t).fields({node:!0,size:!0}).exec(function(t){var e=t[0].node;e?(i.canvas=e,i.release(e),n(e)):r("can not find canvas")})})}},{key:"get",value:function(){return this.canvas}},{key:"dataUrl",value:function(r,t){var i=t.type,u=t.quality,o=t.id;return new Promise(function(e,t){var n=wx.getSystemInfoSync().pixelRatio;wx.canvasToTempFilePath({fileType:i,quality:u,x:0,y:0,width:r.width,height:r.height,destWidth:r.width*n,destHeight:r.height*n,canvasId:o,canvas:r,success:function(t){e(t.tempFilePath)},fail:t})})}},{key:"release",value:function(t){t.getContext("2d").clearRect(0,0,t.width,t.height)}}])&&a(t.prototype,e),n&&a(t,n),r}();var h=/^data:([^;]+);base64,(.*)$/;var d=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return e.reduce(function(t,e){return e.call(null,t)},t)}}(function(t){return h.exec(t).slice(1)},function(t){return[(e=t[1],window.atob(e)),t[0]];var e},function(t){return new Blob([function(t){for(var e=t.length,n=new Uint8Array(e),r=0;r<e;r++)n[r]=t.charCodeAt(r);return n}(t[0])],{type:t[1]})});function s(t,u,o,a,c,e){return e=e||1,function(i){return i.getContext("2d").globalAlpha=e||1,f(t).then(function(t){var e={height:o||t.height,width:u||t.width},n=a(i,e),r=c(i,e);return l(t.path,i,n,r,u,o)})}}function g(t){var e=t.image,n=t.width,r=t.height,i=t.alpha,u=t.distance;return s(e,n,r,function(t,e){return t.width-(e.width+20)},function(t,e){return t.height-u-e.height||t.height-(e.height+20)},i)}function p(t){var e=t.image,n=t.width,r=t.height,i=t.alpha,u=t.distance;return s(e,n,r,function(t,e){return t.width-(e.width+20)},function(t,e){return u||20},i)}function v(t){var e=t.image,n=t.width,r=t.height,i=t.alpha,u=t.distance;return s(e,n,r,function(t,e){return 20},function(t,e){return t.height-u-e.height||t.height-(e.height+20)},i)}function y(t){var e=t.image,n=t.width,r=t.height,i=t.alpha,u=t.distance;return s(e,n,r,function(t,e){return 20},function(t,e){return u||20},i)}function w(t){return s(t.image,t.width,t.height,function(t,e){return(t.width-e.width)/2},function(t,e){return(t.height-e.height)/2},t.alpha)}function b(u,o,a,c,f,l,h,d){return function(t){var e=t.getContext("2d");e.globalAlpha=l||1,e.fillStyle=f||"#ffffff",e.font=c||"24px sans-serif";var n=e.measureText(a),r=u(t,n,e),i=o(t,n,e);return h&&(e.strokeStyle=d||"#000000",e.strokeText(a,r,i)),e.fillText(a,r,i),t}}function m(t){var e=t.text,n=t.font,r=t.fillStyle,i=t.alpha,u=t.stroke,o=t.strokeStyle,a=t.distance;return b(function(t,e){return t.width-(e.width+20)},function(t){return t.height-a||t.height-20},e,n,r,i,u,o)}function x(t){var e=t.text,n=t.font,r=t.fillStyle,i=t.alpha,u=t.stroke,o=t.strokeStyle,a=t.distance;return b(function(){return 20},function(t){return t.height-a||t.height-20},e,n,r,i,u,o)}function O(t){var e=t.text,n=t.font,r=t.fillStyle,i=t.alpha,u=t.stroke,o=t.strokeStyle,a=t.distance;return b(function(t,e){return t.width-(e.width+20)},function(){return a||20},e,n,r,i,u,o)}function j(t){var e=t.text,n=t.font,r=t.fillStyle,i=t.alpha,u=t.stroke,o=t.strokeStyle,a=t.distance;return b(function(){return 20},function(){return a||20},e,n,r,i,u,o)}function P(t){return b(function(t,e,n){return n.textAlign="center",t.width/2},function(t,e,n){return n.textBaseline="middle",t.height/2},t.text,t.font,t.fillStyle,t.alpha,t.stroke,t.strokeStyle)}var k=i;function S(e,n){return Object.keys(n).forEach(function(t){return e[t]=n[t]}),e}var R,_={init:function(){},type:"png",quality:1,id:"watermark"};function T(t){return S(S({},_),t)}function A(r){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,u=T(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{});return R=R||new c,i=i||R.init(u.id).then(function(){return t=r,e=u.init,n=R.get(),f(t,e).then(function(t){return n._canvasRef?(n._canvasRef.style.width=t.width+"px",n._canvasRef.style.height=t.height+"px",n._canvasRef.width=t.width,n._canvasRef.height=t.height):(n.width=t.width,n.height=t.height),t.path});var t,e,n}).then(function(t){return l(t,R.get())}),{draw:function(n){var t=this.then(function(){return t=n,e=R.get(),t.apply(null,[e]);var t,e});return A(r,u,t)},blob:function(t){var e=this.draw(t).then(d);return A(r,u,e)},image:function(t){var e=this.draw(t);return A(r,u,e)},text:function(t){var e=this.draw(t);return A(r,u,e)},then:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return i.then.apply(i,e)},exec:function(t){var e=0<arguments.length&&void 0!==t?t:function(t){return t};return i.then(function(){return R.dataUrl(R.get(),{type:u.type,quality:u.quality,id:u.id})}).then(e)}}}A.image=r,A.text=k,A.destroy=function(){return R.release()}}],i.c=r,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0);function i(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var n,r});